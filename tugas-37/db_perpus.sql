CREATE DATABASE perpustakaan_test;
USE perpustakaan_test;
SET foreign_key_checks = 0;
CREATE TABLE librarian(id INT(11) PRIMARY KEY AUTO_INCREMENT, username VARCHAR(255) NOT NULL , password VARCHAR(255) NOT NULL, name VARCHAR(255) NOT NULL, photo VARCHAR(255), telephone VARCHAR(255), address TEXT);
CREATE TABLE log_librarian( id INT(11) PRIMARY KEY AUTO_INCREMENT, librarian_id INT(11) NOT NULL, FOREIGN KEY (librarian_id) REFERENCES librarian(id), login_at TIMESTAMP, logout_at DATETIME);
CREATE TABLE category(id INT(11) PRIMARY KEY AUTO_INCREMENT, category VARCHAR(255) NOT NULL);
CREATE TABLE publisher(id INT(11) PRIMARY KEY AUTO_INCREMENT, name VARCHAR(255) NOT NULL);
CREATE TABLE author(id INT(11) PRIMARY KEY AUTO_INCREMENT, name VARCHAR(255) NOT NULL);
CREATE TABLE rack(id INT(11) PRIMARY KEY AUTO_INCREMENT, position TEXT);
CREATE TABLE book(id INT(11) PRIMARY KEY AUTO_INCREMENT, rack_id INT(11), publisher_id INT(11) NOT NULL, FOREIGN KEY (rack_id) REFERENCES rack(id), FOREIGN KEY (publisher_id) REFERENCES publisher(id), code VARCHAR(255) NOT NULL , title VARCHAR(255) NOT NULL, cover_picture VARCHAR(255), synopsis TEXT, total_page INT(11), age_limit INT(11), stock INT(11) DEFAULT 1, in_stock INT(11) DEFAULT 1, add_at TIMESTAMP, update_at DATETIME);
ALTER TABLE book ADD librarian_id INT(11) AFTER publisher_id;
ALTER TABLE book ADD FOREIGN KEY (librarian_id) REFERENCES librarian(id);
CREATE TABLE book_category(book_id INT(11) NOT NULL, category_id INT(11) NOT NULL, FOREIGN KEY (book_id) REFERENCES book(id), FOREIGN KEY (category_id) REFERENCES category(id));
CREATE TABLE book_author(book_id INT(11) NOT NULL, author_id INT(11) NOT NULL, FOREIGN KEY (book_id) REFERENCES book(id), FOREIGN KEY (author_id) REFERENCES author(id));
CREATE TABLE rack_content(rack_id INT(11) NOT NULL, category_id INT(11) NOT NULL, FOREIGN KEY (rack_id) REFERENCES rack(id), FOREIGN KEY (category_id) REFERENCES category(id));
CREATE TABLE member( id INT(11) PRIMARY KEY AUTO_INCREMENT, code INT(11) NOT NULL , name VARCHAR(255) NOT NULL, email VARCHAR(255) NOT NULL, telephone VARCHAR(255), address TEXT, create_at TIMESTAMP, update_at DATETIME);
CREATE TABLE borrow(id INT(11) PRIMARY KEY AUTO_INCREMENT, member_id INT(11) , librarian_id INT(11) NOT NULL, code INT(11) NOT NULL, borrow_at TIMESTAMP, FOREIGN KEY (member_id) REFERENCES member(id), FOREIGN KEY (librarian_id) REFERENCES librarian(id));
CREATE TABLE borrow_item( borrow_id INT(11) NOT NULL, book_id INT(11) NOT NULL, book_qty INT(11) NOT NULL, time_limit DATETIME, FOREIGN KEY (borrow_id) REFERENCES borrow(id), FOREIGN KEY (book_id) REFERENCES book(id));
CREATE TABLE back(id INT(11) PRIMARY KEY AUTO_INCREMENT, borrow_id INT(11), create_at TIMESTAMP, FOREIGN KEY (borrow_id) REFERENCES borrow(id));
CREATE TABLE back_item( id INT(11) PRIMARY KEY AUTO_INCREMENT, back_id INT(11) NOT NULL, book_id INT(11) NOT NULL, book_qty INT(11) NOT NULL DEFAULT 1, back_at TIMESTAMP, FOREIGN KEY (back_id) REFERENCES back(id), FOREIGN KEY (book_id) REFERENCES book(id));
CREATE TABLE penalty (id INT(11) PRIMARY KEY AUTO_INCREMENT, back_id INT(11), librarian_id INT(11), create_at INT(11), FOREIGN KEY (back_id) REFERENCES back(id), FOREIGN KEY (librarian_id) REFERENCES librarian(id));
CREATE TABLE penalty_item (id INT(11) PRIMARY KEY AUTO_INCREMENT, penalty_id INT(11), back_item_id INT(11), librarian_id INT(11), create_at TIMESTAMP);
ALTER TABLE back_item ADD librarian_id INT(11) NOT NULL AFTER book_id;
ALTER TABLE member ADD expire_at DATE;
ALTER TABLE member ADD librarian_id INT(11) NOT NULL AFTER id;
ALTER TABLE member ADD FOREIGN KEY (librarian_id) REFERENCES librarian(id);
INSERT INTO librarian (username, password, name, telephone, address) VALUES ('chongieball','qwerty123','Muhammad Iqbal','+6281379858200','Perumahan Mas Permata');
INSERT INTO librarian (username, password, name) VALUES ('kunaluna','12345678','Luna');
INSERT INTO librarian (username, password, name, telephone) VALUES ('wiwiwiwi','qwerty123','Testing','085267774948');
INSERT INTO librarian (username, password, name, address) VALUES ('wowowowo','kambing123','Testing','Anak Kambing Saya');
INSERT INTO librarian (username, password, name) VALUES ('qisans','makoaspin','Qisan Albaraha');
INSERT INTO log_librarian (librarian_id) VALUES (1);
DELETE FROM log_librarian WHERE id = 1;
ALTER TABLE log_librarian CHANGE login_at login_at DATETIME NOT NULL;
INSERT INTO log_librarian (librarian_id, login_at) VALUES (1, NOW());
UPDATE log_librarian SET logout_at = NOW() WHERE id = 2;
INSERT INTO log_librarian (librarian_id, login_at) VALUES (3, NOW());
UPDATE log_librarian SET logout_at = '2017-02-02 15:10:10' WHERE librarian_id = 3;
INSERT INTO log_librarian (librarian_id, login_at) VALUES (4, '2017-02-03 00:00:00');
INSERT INTO log_librarian (librarian_id, login_at, logout_at) VALUES (5, NOW(), '2017-02-02 16:55:00');
INSERT INTO category (category) VALUES ('education'), ('novel');
INSERT INTO category (category) VALUES ('techno'), ('science'), ('history');
INSERT INTO publisher (name) VALUES ('erlangga'), ('tiga serangkai'), ('djambatan'), ('balai pustaka'), ('bina kasih');
INSERT INTO author (name) VALUES ('iqbal'), ('wak doyok'), ('woody'), ('luna'), ('urie');
INSERT INTO book (rack_id, publisher_id, librarian_id, code, title, synopsis, total_page) VALUES (1, 1, 1,      'EDU001', 'kumpulan soal matematika', 'tips dan trik memahami rumus dan soal matematika', 321);
INSERT INTO book (rack_id, publisher_id, librarian_id, code, title, synopsis, total_page) VALUES (3, 2, 2, 'NOV011', 'surat pak pos', 'om surat om', 50), (4, 1, 5, 'NOV012', 'om telolet om', 'menceritakan tentang anak smp yang gemar mendengar klakson bus', 20);
INSERT INTO book_author VALUES (1,1),(1,2),(2,1),(2,5),(3,5);
INSERT INTO book_category VALUES (1,1), (2,2), (2,3), (4,3), (5,3);
INSERT INTO member (librarian_id, code, name, email, telephone, expire_at) VALUES (2, 23456, 'Chelyn Adelia', 'chelchel@gmail.com', '085267774948', '2019-03-03'), (2, 34556, 'Fadel', 'oleng@gamuu.com', '+6281345678988', '2019-03-03');
INSERT INTO member (librarian_id, code, name, email, expire_at) VALUES  (1, 12345, 'Muhammad Iqbal', 'chongg1243@gmail.com', '2018-01-01'), (1, 13456, 'Luna', 'lunakuna@mail.com', '2018-01-01'), (2, 14567, 'Poi', 'poiaaa@go.blog', '2019-02-02');
INSERT INTO member (librarian_id, code, name, email, telephone, expire_at) VALUES (2, 34561, 'Adit', 'dit@mail.com', '089923477881' '2020-02-02');
INSERT INTO borrow (member_id, librarian_id, code) VALUES (1, 1, 12345), (2, 1, 23456), (3, 2, 34567),(4, 4, 56788), (5, 1, 23455);
INSERT INTO borrow_item VALUES (1, 1, 1, '2017-05-05 12:00:00'), (1, 2, 2, '2017-04-04 12:00:00'), (2, 4, 3, '2017-04-04 12:00:00'), (1, 3, 2, '2017-04-04 12:00:00'), (5, 5, 5, '2017-04-04 12:00:00');
INSERT INTO back (borrow_id) VALUES (1), (2), (3), (1), (2);
ALTER TABLE back ADD librarian_id INT(11) AFTER borrow_id;
ALTER TABLE back ADD FOREIGN KEY (librarian_id) REFERENCES librarian(id);
UPDATE back SET librarian_id = 1 WHERE borrow_id = 1;
UPDATE back SET librarian_id = 2 WHERE borrow_id = 2 OR borrow_id = 3;
INSERT INTO back_item (back_id, book_id, librarian_id, book_qty) VALUES (1, 1, 1, 1), (2, 4, 2, 2), (3, 3, 2, 2), (4, 3, 1, 3), (5, 4, 2, 1);
SET foreign_key_checks = 1;
